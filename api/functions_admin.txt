<?php

/**
 * ADMINISTRACIÓN - CORE FUNCTIONS
 * Versión 10.2 - Corrección de Parámetros de Finanzas
 */

// ... (Resto de funciones admin_get_settings, admin_update_settings, etc permanecen igual)

function admin_add_balance($pdo, $input) {
    // Sincronizado con AdminUsers.tsx: db.adminAddBalance sends adminId, targetId, amount
    // Pero el middleware de db.ts en el cliente mapea a userId
    $targetId = $input['userId'] ?? $input['targetId'] ?? null;
    $amount = floatval($input['amount'] ?? 0);

    if (!$targetId || $amount <= 0) respond(false, null, 'Datos de recarga inválidos');

    $pdo->beginTransaction();
    try {
        $pdo->prepare("UPDATE users SET balance = balance + ? WHERE id = ?")->execute([$amount, $targetId]);
        $pdo->prepare("INSERT INTO transactions (id, buyerId, amount, type, timestamp) VALUES (?, ?, ?, 'DEPOSIT', ?)")
            ->execute([uniqid('dep_'), $targetId, $amount, time()]);
        
        $pdo->prepare("INSERT INTO notifications (id, userId, type, text, link, isRead, timestamp) VALUES (?, ?, 'SYSTEM', ?, '/profile', 0, ?)")
            ->execute([uniqid('n_'), $targetId, "El administrador ha recargado $amount $ en tu cuenta.", '/profile', time()]);
            
        $pdo->commit();
        respond(true);
    } catch (Exception $e) {
        $pdo->rollBack();
        respond(false, null, $e->getMessage());
    }
}

// ... (Resto de funciones permanecen igual)
?>